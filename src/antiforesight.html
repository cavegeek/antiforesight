<!DOCTYPE html>
<!-- (c) 2018 Jason Stumpf -->
<title>Anti-Foresight</title>
<style>
  body {
    margin: 0;
    padding: 0;
    overflow: hidden;
  }
  div {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    width: 100%;
  }
  svg {
    display: block;
    margin: auto;
    max-height: 100%;
  }
</style>
<script>

'use strict';

const board = {x: 30, y: 30};

function svgElem(tag) {
  return document.createElementNS("http://www.w3.org/2000/svg", tag);
}

function block(x, y) {
  let block = svgElem("use");
  block.setAttribute("href", "#block");
  block.setAttribute("x", x);
  block.setAttribute("y", y);
  document.getElementById('sprites').appendChild(block);
}

function genFloors() {
  for(let i = 0; i < 20; ++i) {
    let y = Math.floor(Math.random()*board.y/3)*3;
    let start = Math.floor(Math.random()*board.x);
    let end = Math.min(start + Math.random()*8, board.x);
    for(let x = start; x < end; ++x) {
      block(x,y);
    }
  }
}

function init() {
  genFloors();

  document.addEventListener('keydown', move);
}

function move(event) {
  switch(event.key) {
    case 'ArrowRight':
      const p = document.getElementById('player');
      const x = p.getAttribute('x');
      p.setAttribute('x', parseFloat(x) + 0.1);
    break;
  }
}

window.onload = init;
</script>
<div>
<svg id="image"
     viewBox="0 0 30 30"
     xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="sky_grad" x1="0" x2="0.1" y1="0" y2="1">
      <stop offset="0%" stop-color="#202" />
      <stop offset="50%" stop-color="#40B" />
      <stop offset="90%" stop-color="#00C" />
      <stop offset="100%" stop-color="#147" />
    </linearGradient>
    <filter id="block_turb" filterUnits="objectBoundingBox" x="0" y="0" width="1" height="1">
      <feTurbulence id="turb" type="fractalNoise" baseFrequency="2 3" numOctaves="4" />
      <feComposite in="SourceGraphic" operator="atop" />
    </filter>
    <g id="block">
      <rect x="0" y="0" width="1" height="1" fill="#FA8" />
      <rect x="0" y="0" width="1" height="1" fill="#A00" filter="url(#block_turb") />
      <rect x="0" y="0" width="1" height="1" stroke="black" stroke-width="0.1" fill="none"/>
    </g>
    <g id="player_sprite">
      <ellipse cx="0.5" cy="0" rx="0.5" ry="1" fill="green" />
    </g>
  </defs>
  <rect id="bg" x="0" y="0" width="30" height="30" fill="url(#sky_grad)" />
  <g id="sprites">
    <use href="#block" x="3" y="20" />
  </g>
  <use id="player" href="#player_sprite" x="3" y="19" />
</svg>
</div>
